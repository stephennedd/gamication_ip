<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Leaderboard</title>
    <link rel="stylesheet" href="./css/style.css">
</head>
<body>
    <!-- background -->
    <div id="container">
    </div>

    <div class="dropdown">
        <button class="dropbtn">Select leaderboard</button>
            <div class="dropdown-content">
                <a class="dropdown-link" href="#">Overall leaderboard</a>
                <a class="dropdown-link" href="#">Frogger leaderboard</a>
                <a class="dropdown-link" href="#">FlappyBird leaderboard</a>
            </div>
    </div> 

    <!-- title -->
    <div class="title">
        <h1>Leaderboard</h1>
    </div>

    <!-- buttons -->
    <div class="buttons">
        <button class="start_btn">Start Game</button>
        <button class="quit_btn">Quit</button>
    </div>
    

    <!-- leaderboard -->
    <div class="leaderboard">
        <div class="leaderboard-container">
            <table class="leaderboard-table">
                <thead>
                    <tr>
                        <th>Position</th>
                        <th>Player Name</th>
                        <th>Score</th>
                        <th>Badges</th>
                    </tr>
                </thead>
                <tbody id="leaderboard-body">
                    <!-- Leaderboard data will be dynamically added here -->
                </tbody>
            </table>
        </div>
    </div>
    
    
    <script>
        // Sample leaderboard data (you can replace this with your API or data source)
        let leaderboardData = [
            { playerName: "John", score: 500, badges: ["badge1.png", "badge2.png"] },
            { playerName: "Emma", score: 400 , badges: ["badge3.png"]},
            { playerName: "Michael", score: 300, badges: []  },
            { playerName: "Sophia", score: 200 , badges: ["badge4.png"]},
            { playerName: "William", score: 100, badges: ["badge5.png", "badge6.png"] },
        ];

        // Function to populate the leaderboard table
        function populateLeaderboard() {
            // Sort the leaderboard data based on scores in descending order
            leaderboardData.sort((a, b) => b.score - a.score);

            const leaderboardBody = document.getElementById('leaderboard-body');
            leaderboardBody.innerHTML = ''; // Clear existing leaderboard data

            leaderboardData.forEach((entry, index) => {
                const position = index + 1;

                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${position}</td>
                    <td>${entry.playerName}</td>
                    <td>${entry.score}</td>
                    <td>${entry.badges.map(badge => `<img src="./assets/images/${badge}" height="25px" alt="Badge">`).join('')}</td>
                `;
                leaderboardBody.appendChild(row);
            });
        }
        async function getDataFromAPI() {
    let token = 'YourToken'; // replace with your actual token

    try {
        let response = await fetch('https://localhost:7186/api/Leaderboards/main', {
            method: 'GET',
            headers: {
                'Authorization': `Bearer ${token}`,
                'Content-Type': 'application/json'
            }
        });
        
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }

        let data = await response.json();
        console.log('Received data:', data); // Print the raw data

        // Extract highScores array
        let highScores = data.highScores.$values;

        console.log('Extracted highScores:', highScores); // Print the extracted highScores

        // Map the highScores array to an array of simplified objects
        leaderboardData = highScores.reduce((result, scoreEntry) => {
            console.log('Processing scoreEntry:', scoreEntry); // Print each scoreEntry being processed

            if (scoreEntry.user) {
                result.push({
                    playerName: scoreEntry.user.id,
                    score: scoreEntry.score,
                    badges: [] // Add badge logic here if available
                });
            }

            return result;
        }, []);

        // Call populateLeaderboard() to update the leaderboard
        populateLeaderboard();
    } catch (error) {
        console.log('Fetch Error: ', error);
    }
}

        // Call the function to populate the leaderboard on page load
        getDataFromAPI();
        
    </script>

    <script src="./js/starfield.js"></script>
    <script>
        //  Get the container and turn it into a starfield.
        var container = document.getElementById('container');
        var starfield = new Starfield();
        starfield.initialise(container);
        starfield.start();
    </script>
</body>
</html>